<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Keeping on top of invoices with the Freshbooks API and Ruby
  
 | Matt Harrison</title>



<link rel="stylesheet" href="/book.min.19b2fad70b59ba6d7af5b9f71e301499899fb2a0626d295a45d769a484a7ace9.css">


<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

  <link rel="stylesheet" href="/css/routeros.css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">
    <aside class="book-menu fixed">
      <nav role="navigation">
<div class="brand">
    <a href="https://matt-harrison.com/"><img class="profile-image" src="https://matt-harrison.com/content/images/2018/07/153180020555179787--1--2.gif" alt=""></a>
  <h2 class="book-brand"><a href="https://matt-harrison.com/">Matt Harrison</a></h2>
  <p>Software developer and author based in the UK.</p>

  <div class="linksBlock">
    <p><a href="http://twitter.com/mt_harrison"><s>Twitter</s></a></p>
    <p><a href="https://github.com/mtharrison">Github</a></p>
    <p><a href="http://stackoverflow.com/users/1402929/matt-harrison">Stack Overflow</a></p>
    
  </div>
</div>




    

  
  






  <ul>
  
  </ul>











</nav>



    </aside>

    <div class="book-posts">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Keeping on top of invoices with the Freshbooks API and Ruby
  
</strong>
</header>

      

<header class="markdown">
  <h1>Keeping on top of invoices with the Freshbooks API and Ruby</h1>
  <h5>
    <strong>March 24, 2014</strong>
  </h5>
</header>
<article class="markdown"><p>Freshbooks is a great tool as a freelancer, for managing your billing and sending invoices. It is however lacking in a few places for me.</p>

<p>One thing I really want to see when I log in is how many days have elapsed since I sent each invoice out. Yes I could work this out from the dates, but I don&rsquo;t have the time quite often so things start slipping.</p>

<p>Luckily there&rsquo;s an API we can use, and I knocked up this Ruby script in 10 minutes to give me a nicely formatted view of all my active invoices and the days since I created them. There&rsquo;s no field in the XML output for <em>days since sent</em>, and I often prepare an invoice before sending it. However it will have to do until they change that.</p>

<p>I&rsquo;ve used the gem <code>terminal-table</code> to produce an attractive CLI table output:</p>

<pre><code class="language-markup">+------------+--------------+-------------+---------------------+
| Invoice no | Client       | Outstanding | Days since invoiced |
+------------+--------------+-------------+---------------------+
| 0000054    | ACME Company | £1000.50    | 3                   |
| 0000053    | ACME Company | £20.00      | 5                   |
| 0000052    | ACME Company | £811.00     | 11                  |
| 0000051    | ACME Company | £12.00      | 14                  |
| 0000050    | ACME Company | £36.00      | 14                  |
| 0000049    | ACME Company | £37.00      | 24                  |
| 0000045    | ACME Company | £70.00      | 26                  |
| 0000041    | ACME Company | £700.00     | 35                  |
+------------+--------------+-------------+---------------------+
| Total Owed |              | £2686.50    |                     |
+------------+--------------+-------------+---------------------+
</code></pre>

<p>Here&rsquo;s the script, I hope it&rsquo;s of some use to somebody else (Note: Please remove the additional &lsquo;;&rsquo;s within the XML.)</p>

<pre><code class="language-ruby language-markup">#!/bin/env ruby
# encoding: utf-8

require 'xmlsimple'
require 'terminal-table'
require 'date'

API_TOKEN = "" #Put your freshbooks api token here
API_URL = "" #Put your freshbooks api url
CURRENCY_SYMBOL = "£"

xml = '&lt?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;request method=&quot;invoice.list&quot;&gt;
  &lt;folder&gt;active&lt;/folder&gt;
&lt;/request&gt;'
response = `curl -s -u #{API_TOKEN}:X #{API_URL} -d '#{xml}'`
data = (XmlSimple.xml_in response)['invoices'][0]['invoice']
owed = 0

table = Terminal::Table.new do |t|
  t.add_row [
    'Invoice no',
    'Client',
    'Outstanding',
    'Days since invoiced'
  ]

  t.add_separator

  data.each do |i|
    t.add_row [
      i['number'][0],
      i['organization'][0],
      CURRENCY_SYMBOL + i['amount_outstanding'][0],
      (Date.today - Date.parse(i['date'][0])).to_i
    ]
    owed += i['amount_outstanding'][0].to_f
  end

  t.add_separator
  t.add_row [
    'Total Owed',
    '',
    CURRENCY_SYMBOL + owed.to_s,
    ''
  ]
end

puts table
</code></pre>

<p>I&rsquo;ve also added this to my path so I can call it anywhere with just the command <code>invoices</code>:</p>

<pre><code class="language-markup">sudo ln -s /path/to/ruby/script.rb /usr/local/bin/invoices && chmod u+x /usr/local/bin/invoices</code></pre>
</article>

      
    </div>
  </main>

  
  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49752272-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-49752272-2');
  </script>
</body>

</html>
