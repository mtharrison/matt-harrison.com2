<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Ray Tracing: WebAssembly vs JavaScript
  
 | Matt Harrison</title>



<link rel="stylesheet" href="/book.min.19b2fad70b59ba6d7af5b9f71e301499899fb2a0626d295a45d769a484a7ace9.css">


<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

  <link rel="stylesheet" href="/css/routeros.css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">
    <aside class="book-menu fixed">
      <nav role="navigation">
<div class="brand">
    <a href="https://matt-harrison.com/"><img class="profile-image" src="https://matt-harrison.com/content/images/2018/07/153180020555179787--1--2.gif" alt=""></a>
  <h2 class="book-brand"><a href="https://matt-harrison.com/">Matt Harrison</a></h2>
  <p>Software developer and author based in the UK.</p>

  <div class="linksBlock">
    <p><a href="http://twitter.com/mt_harrison"><s>Twitter</s></a></p>
    <p><a href="https://github.com/mtharrison">Github</a></p>
    <p><a href="http://stackoverflow.com/users/1402929/matt-harrison">Stack Overflow</a></p>
    
  </div>
</div>




    

  
  






  <ul>
  
  </ul>











</nav>



    </aside>

    <div class="book-posts">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Ray Tracing: WebAssembly vs JavaScript
  
</strong>
</header>

      

<header class="markdown">
  <h1>Ray Tracing: WebAssembly vs JavaScript</h1>
  <h5>
    <strong>August 12, 2018</strong>
  </h5>
</header>
<article class="markdown"><p>I&rsquo;ve spent the last couple of weeks learning about the art and science of <a href="https://en.wikipedia.org/wiki/Ray_tracing_(graphics)">Ray Tracing</a>. Ray tracing, for those who aren&rsquo;t familiar is one technique for generating 3d computer graphics. Ray tracing isn&rsquo;t the fastest way to generate 3d images but it&rsquo;s appeal lies in both the realistic effects that can be achieved and in the elegance of simplicity of the technique. This technique is used in movies and for photo-realistic architectural renderings.</p>
<!-- raw HTML omitted -->
<p>Without getting too much into the weeds, ray tracing works by going through each pixel of the resulting 2d image and shooting a virtual light ray into the scene and tracing it&rsquo;s path by reflecting it off surfaces to determine which color to set the pixel. It&rsquo;s that simple really. For a simple scene consisting of spheres and planes we can use some basic geometry with vectors to calculate intersection points with objects. To determine shadows, we similarly shoot a ray from an object to our virtual light source and check if there are any intersections in between and therefore the object is in shadow.</p>
<p>Let&rsquo;s take a step back for a moment though and I&rsquo;ll tell you why I&rsquo;ve been learning about this. For the past few months I&rsquo;ve been toying about with WebAssembly. The examples I&rsquo;ve built using WebAssembly were very simple and could easily have been written in JavaScript with perfectly adequate performance. This got me thinking it&rsquo;s about time I make something to really shows where WebAssembly shines. This led me down the path of thinking about very compute-demanding applications. An obvious example is 3d graphics rendering. Even a small scene like the ones I&rsquo;ve been creating involve computing millions of vector dot product calculations per second. This kind of CPU-intensive application seemed right up the street of WebAssembly.</p>
<p>I started out with this great example, <a href="https://github.com/tmcw/literate-raytracer">Literate Raytracer</a> by <a href="https://github.com/tmcw">Tom MacWright</a>. The explanations in the code comments really made sense to me. I extended Tom&rsquo;s code to add some additional features such as support for planes, checkerboard textures and some improved reflections, to get more familiar with the techniques. There&rsquo;s some outstanding content available at <a href="https://www.scratchapixel.com/">https://www.scratchapixel.com/</a>. If you want to learn more about Raytracing or computer graphics in general, it would be a great place to start.</p>
<p>Once I had a JavaScript version of my ray tracer in place with a simple scene, I got to work on creating a WebAssembly version. Rust is my language of choice for writing Wasm modules. I just ported a straight 1:1 copy of my JS ray tracer over to Rust and compiled it using the great tools <a href="https://github.com/rustwasm/wasm-pack">wasm-pack</a> and <a href="https://github.com/rustwasm/wasm-bindgen">wasm-bindgen</a>.</p>
<!-- raw HTML omitted -->
<p>Just to be clear I wasn&rsquo;t out to make the fastest or most fully-featured Ray tracer, for one thing, that&rsquo;s not really my avenue, I&rsquo;m mainly a web developer. My goal here was to see how much I could demand from my browser and how it would perform compared to JavaScript. There&rsquo;s another more subtle point to make here. I didn&rsquo;t want to spend too much time on optimisation of either the JS or the Wasm version. I understand that&rsquo;s it&rsquo;s often possible to get JS to perform on a par or close to Wasm&rsquo;s execution performance but doing so involves knowing some compiler tricks and optimisation strategies. I&rsquo;m not that interested in learning those and I don&rsquo;t believe most should have to either. I wanted to compare a naive implementation.</p>
<p>This seems to vary per browser but as a rough, not scientific result, here&rsquo;s what I was getting in Firefox Quantum 61.0.2:</p>
<ul>
<li><strong>WebAssembly: 22.0fps</strong></li>
<li><strong>JavaScript: 2.5fps</strong></li>
</ul>
<p>So in conclusion saw around a 9x speedup when I wrote a naive port of a JavaScript application to WebAssembly. I have to say I&rsquo;m quite impressed with this result.</p>
<p>You can play with my Ray tracer by getting the code on <a href="https://github.com/mtharrison/wasm-raytracer">Github</a> or there&rsquo;s a <a href="https://mtharrison.github.io/wasm-raytracer/">fun interactive example here</a> where you can compare the performance on your own machine.</p>
<p>I&rsquo;m sure I&rsquo;ve missed some things out here, so feel free to leave a comment below or ping me on twitter @mt_harrison.</p>
</article>

      
    </div>
  </main>

  
  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49752272-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-49752272-2');
  </script>
</body>

</html>
