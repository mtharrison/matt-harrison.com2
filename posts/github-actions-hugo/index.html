<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.74.1" />

  <title>Automating this Hugo Blog with GitHub Actions &middot; Matt Harrison</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="Automating this Hugo Blog with GitHub Actions">
<meta itemprop="description" content="This Blog is built with the wonderful Hugo static site generator. It is hosted on GitHub pages too and uses the Soho theme - that&rsquo;s a lot of great stuff for free.
GitHub pages hosts a static site straight off your repo, either via a specific docs folder on master branch or a dedicated gh-pages branch. To build the static directory Hugo just has a simple hugo command to run. Up till now I would run that hugo command after making and changes and then commit and push the changes to my blog repo, simple right?">
<meta itemprop="datePublished" content="2020-07-14T00:00:00&#43;01:00" />
<meta itemprop="dateModified" content="2020-07-14T00:00:00&#43;01:00" />
<meta itemprop="wordCount" content="942">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automating this Hugo Blog with GitHub Actions"/>
<meta name="twitter:description" content="This Blog is built with the wonderful Hugo static site generator. It is hosted on GitHub pages too and uses the Soho theme - that&rsquo;s a lot of great stuff for free.
GitHub pages hosts a static site straight off your repo, either via a specific docs folder on master branch or a dedicated gh-pages branch. To build the static directory Hugo just has a simple hugo command to run. Up till now I would run that hugo command after making and changes and then commit and push the changes to my blog repo, simple right?"/>


<meta property="og:title" content="Automating this Hugo Blog with GitHub Actions" />
<meta property="og:description" content="This Blog is built with the wonderful Hugo static site generator. It is hosted on GitHub pages too and uses the Soho theme - that&rsquo;s a lot of great stuff for free.
GitHub pages hosts a static site straight off your repo, either via a specific docs folder on master branch or a dedicated gh-pages branch. To build the static directory Hugo just has a simple hugo command to run. Up till now I would run that hugo command after making and changes and then commit and push the changes to my blog repo, simple right?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matt-harrison.com/posts/github-actions-hugo/" />
<meta property="article:published_time" content="2020-07-14T00:00:00+01:00" />
<meta property="article:modified_time" content="2020-07-14T00:00:00+01:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  
<style type="text/css">
  .sidebar {
    background-color: #141b19;
  }

  .read-more-link a {
    border-color: #141b19;
  }

  .pagination li a {
    color: #141b19;
    border: 1px solid #141b19;
  }

  .pagination li.active a {
    background-color: #141b19;
  }

  .pagination li a:hover {
    background-color: #141b19;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #141b19;
  }
</style>



  <link type="text/css" rel="stylesheet" href="/css/blog.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        
          
          <div class="author-image">
            <a href="/"><img src="/images/profile.jpg" class="img-circle img-headshot center" alt="Profile Picture"></a>
          </div>
          
        

        <h1><a href="/">Matt Harrison</a></h1>

        
        <p class="lead">Software developer and author based in the UK</p>
        
      </div>

      <nav>
        <ul class="sidebar-nav">
          <li>
            <a href="https://github.com/mtharrison">GitHub</a>
          </li><li>
            <a href="https://zety.com/mycv/mharrison">Resume</a>
          </li>
        </ul>
      </nav>
    </div>
  </aside>


  <main class="content container">
  <div class="post">
  <h1>Automating this Hugo Blog with GitHub Actions</h1>

  <div class="post-date">
    <time datetime="2020-07-14T00:00:00&#43;0100">Jul 14, 2020</time> &middot; 5 min read
  </div>

  <p>This Blog is built with the wonderful <a href="https://gohugo.io/">Hugo</a> static site generator. It is hosted on <a href="https://pages.github.com/">GitHub pages</a> too and uses the <a href="https://themes.gohugo.io//theme/soho/about/">Soho theme</a> - that&rsquo;s a lot of great stuff for free.</p>
<p>GitHub pages hosts a static site straight off your repo, either via a specific <code>docs</code> folder on <code>master</code> branch or a dedicated <code>gh-pages</code> branch. To build the static directory Hugo just has a simple <code>hugo</code> command to run. Up till now I would run that <code>hugo</code> command after making and changes and then commit and push the changes to my blog repo, simple right?</p>
<p>I&rsquo;ve been looking into <a href="https://github.com/features/actions">GitHub actions</a> recently and doing quite a bit of devopsy stuff at <a href="https://github.com/features/actions">work</a> so I thought this might be another ripe opportunity to take advantage of automation to make my life just that little bit easier.</p>
<p>An added advantage to letting GitHub handle this is that I can then write or edit blog posts on the go via the GitHub UI, when I don&rsquo;t easily have access to my laptop and usual build environment.</p>
<p>When I push to <code>master</code> of my blog repo, I want a workflow to do the following for me:</p>
<ol>
<li>Build latest static site built with a specific version of Hugo</li>
<li>Commit to <code>gh-pages</code> branch (if there are changes)</li>
<li>Push to remote <code>gh-pages</code> branch (if there are changes)</li>
</ol>
<p>I want to use a specific version of Hugo so I can be sure I tested my blog on this same version locally, rather than just pull in say the latest version from <code>apt-get</code>. I want to use the <code>gh-pages</code> branch approach rather than serving the site from a directory on <code>master</code> because I don&rsquo;t want to have to do a <code>git pull</code> everytime I make any changes to fetch the latest automatic commits.</p>
<p>Here&rsquo;s the full workflow that I came up with:</p>
<p><em><a href="https://github.com/mtharrison/matt-harrison.com2/blob/master/.github/workflows/build.yml">.github/workflows/build.yml</a></em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">name</span>: build

<span style="color:#66d9ef">on</span>:
  <span style="color:#66d9ef">push</span>:
    <span style="color:#66d9ef">branches</span>: [master]

<span style="color:#66d9ef">jobs</span>:
  <span style="color:#66d9ef">build</span>:
    <span style="color:#66d9ef">name</span>: Build Hugo Site
    <span style="color:#66d9ef">runs-on</span>: ubuntu-latest
    <span style="color:#66d9ef">steps</span>:
      - <span style="color:#66d9ef">name</span>: Install Hugo
        <span style="color:#66d9ef">env</span>:
          <span style="color:#66d9ef">HUGO_VERSION</span>: <span style="color:#ae81ff">0.74.1</span>
        <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">          mkdir ~/hugo</span>
          cd ~/hugo
          curl -L <span style="color:#e6db74">&#34;https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz&#34;</span> --output hugo.tar.gz
          tar -xvzf hugo.tar.gz
          sudo mv hugo /usr/local/bin

      - <span style="color:#66d9ef">name</span>: Checkout master branch
        <span style="color:#66d9ef">uses</span>: actions/checkout@v2
        <span style="color:#66d9ef">with</span>:
          <span style="color:#66d9ef">ref</span>: master
          <span style="color:#66d9ef">path</span>: main
          <span style="color:#66d9ef">submodules</span>: <span style="color:#66d9ef">true</span>

      - <span style="color:#66d9ef">name</span>: Checkout gh-pages branch
        <span style="color:#66d9ef">uses</span>: actions/checkout@v2
        <span style="color:#66d9ef">with</span>:
          <span style="color:#66d9ef">ref</span>: gh-pages
          <span style="color:#66d9ef">path</span>: gh-pages

      - <span style="color:#66d9ef">name</span>: Hugo Build
        <span style="color:#66d9ef">run</span>: cd main <span style="color:#75715e">&amp;&amp;</span> hugo

      - <span style="color:#66d9ef">name</span>: Copy files
        <span style="color:#66d9ef">run</span>: cp -rf main/public/* gh-pages/

      - <span style="color:#66d9ef">name</span>: Commit changes
        <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">          cd gh-pages</span>

          git config --local user.email <span style="color:#e6db74">&#34;actions@github.com&#34;</span>
          git config --local user.name <span style="color:#e6db74">&#34;GitHub Action&#34;</span>

          git add -A .

          if git diff-index --quiet HEAD --; then
            echo <span style="color:#e6db74">&#34;No changes...&#34;</span>
          else
            git commit -m <span style="color:#e6db74">&#34;[CI] build hugo static site&#34;</span>
            git push
          fi
</code></pre></div><p>I think the workflow is pretty simple to understand, however I&rsquo;ll go through what each part does.</p>
<p>The following part defines the name of the workflow and also how it should be triggered. In this case I only want my <code>build</code> workflow to be triggered when a push happens on the <code>master</code> branch.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">name</span>: build

<span style="color:#66d9ef">on</span>:
  <span style="color:#66d9ef">push</span>:
    <span style="color:#66d9ef">branches</span>: [master]
</code></pre></div><p>The following step installs the Hugo binary by pulling a specific version from GitHub releases. I&rsquo;ve used an environment variable to define the version that I&rsquo;m interested in. When new releases come out, I will first test them locally before bumping this. In practice I don&rsquo;t change this too often. <code>run</code> just runs a shell script that you pass as a string.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">    <span style="color:#66d9ef">steps</span>:
      - <span style="color:#66d9ef">name</span>: Install Hugo
        <span style="color:#66d9ef">env</span>:
          <span style="color:#66d9ef">HUGO_VERSION</span>: <span style="color:#ae81ff">0.74.1</span>
        <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">          mkdir ~/hugo</span>
          cd ~/hugo
          curl -L <span style="color:#e6db74">&#34;https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz&#34;</span> --output hugo.tar.gz
          tar -xvzf hugo.tar.gz
          sudo mv hugo /usr/local/bin
</code></pre></div><p>Next up I use a prebaked Action to checkout both the <code>master</code> (with raw posts) and the <code>gh-pages</code> (generated static site) branches. Additionally, I checkout submodules for the <code>master</code> branch as my theme is included via a Git submodule. I check these 2 branches out side-by-side into 2 different directories.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">    <span style="color:#66d9ef">steps</span>:

      ...

      - <span style="color:#66d9ef">name</span>: Checkout master branch
        <span style="color:#66d9ef">uses</span>: actions/checkout@v2
        <span style="color:#66d9ef">with</span>:
          <span style="color:#66d9ef">ref</span>: master
          <span style="color:#66d9ef">path</span>: main
          <span style="color:#66d9ef">submodules</span>: <span style="color:#66d9ef">true</span>

      - <span style="color:#66d9ef">name</span>: Checkout gh-pages branch
        <span style="color:#66d9ef">uses</span>: actions/checkout@v2
        <span style="color:#66d9ef">with</span>:
          <span style="color:#66d9ef">ref</span>: gh-pages
          <span style="color:#66d9ef">path</span>: gh-pages
</code></pre></div><p>Next I want to actually build the static site. This is as easy as calling <code>hugo</code> in the directory containing the <code>master</code> branch. Then I&rsquo;ll copy the generated files over to the checked out <code>gh-pages</code> branch dir.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">    <span style="color:#66d9ef">steps</span>:

      ...

      - <span style="color:#66d9ef">name</span>: Hugo Build
        <span style="color:#66d9ef">run</span>: cd main <span style="color:#75715e">&amp;&amp;</span> hugo

      - <span style="color:#66d9ef">name</span>: Copy files
        <span style="color:#66d9ef">run</span>: cp -rf main/public/* gh-pages/
</code></pre></div><p>In this final step, I set up some config so we can actually change things in <code>git</code>. Next inside the <code>gh-pages</code> dir I check if anything has actually changed (we&rsquo;re comparing what was checked out from the remote <code>gh-pages</code> branch versus what we just generated from <code>master</code>). If nothing changed, there&rsquo;s nothing to do. Otherwise we&rsquo;ll make a new commit and push the changes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">    <span style="color:#66d9ef">steps</span>:

      ...

      - <span style="color:#66d9ef">name</span>: Commit changes
        <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">          cd gh-pages</span>

          git config --local user.email <span style="color:#e6db74">&#34;actions@github.com&#34;</span>
          git config --local user.name <span style="color:#e6db74">&#34;GitHub Action&#34;</span>

          git add -A .

          if git diff-index --quiet HEAD --; then
            echo <span style="color:#e6db74">&#34;No changes...&#34;</span>
          else
            git commit -m <span style="color:#e6db74">&#34;[CI] build hugo static site&#34;</span>
            git push
          fi
</code></pre></div><p>Once the changes are pushed up to <code>gh-pages</code> GitHub will take care of deploying the new static files to my site here.</p>
<p>You may wonder if the <code>git push</code> that happens within the workflow will trigger another build and result in an infinite loop. Thankfully the GitHub folks have thought about that and any <a href="https://docs.github.com/en/actions/configuring-and-managing-workflows/authenticating-with-the-github_token#using-the-github_token-in-a-workflow">events triggered from your workflow will not in turn triggers new workflows</a>.</p>
<p>So in summary I can just add new posts to my blog as <code>.md</code> files, push them to <code>master</code> and GitHub will take care of building my static site and redeploying it all within a matter of seconds. And all happening automatically via GitHub Actions and GitHub Pages 🚀</p>
<p><img src="https://cldup.com/xKUxlqHIQc.png" alt="magic"></p>

</div>


  </main>

  <footer>
  <div>
    &copy; Matt Harrison 2022

    &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  <script src="/js/blog.js"></script>

  
</body>
</html>
